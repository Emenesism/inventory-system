from __future__ import annotations

from typing import NamedTuple

from PySide6.QtCore import QCoreApplication


class HelpContent(NamedTuple):
    title: str
    body: str


def _t(text: str) -> str:
    return QCoreApplication.translate("HelpContent", text)


def _wrap(body: str) -> str:
    return (
        '<div dir="rtl" style="font-size: 13px; line-height: 1.9; '
        'text-align: right;">' + body.strip() + "</div>"
    )


HELP_CONTENT: dict[str, HelpContent] = {
    "Inventory": HelpContent(
        title=_t("راهنمای بخش موجودی"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>در این صفحه می‌توانید کالاها را جستجو، ویرایش، ذخیره و خروجی بگیرید.</p>

                <h3>دکمه‌های اصلی</h3>
                <ul>
                    <li><b>انتخاب فایل موجودی:</b> انتخاب یا جایگزینی فایل اصلی موجودی.</li>
                    <li><b>بارگذاری مجدد:</b> بازخوانی داده‌ها و حذف تغییرات ذخیره‌نشده.</li>
                    <li><b>ذخیره تغییرات:</b> ثبت تمام ویرایش‌ها در موجودی.</li>
                    <li><b>خروجی:</b> ذخیره خروجی اکسل یا CSV از اطلاعات فعلی.</li>
                </ul>

                <h3>نکته</h3>
                <p>برای ویرایش هر ردیف، مقدار را در جدول تغییر دهید و در پایان روی «ذخیره تغییرات» بزنید.</p>
                """
            )
        ),
    ),
    "Sales Import": HelpContent(
        title=_t("راهنمای بخش ورود فروش"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>این صفحه فایل فروش را می‌خواند، پیش‌نمایش می‌دهد و در صورت تایید، موجودی را به‌روزرسانی می‌کند.</p>

                <h3>دکمه‌های اصلی</h3>
                <ul>
                    <li><b>انتخاب فایل فروش:</b> انتخاب فایل اکسل یا CSV فروش.</li>
                    <li><b>پیش‌نمایش:</b> نمایش نتیجه تطبیق و خطاها پیش از اعمال.</li>
                    <li><b>ثبت فروش:</b> اعمال ردیف‌های معتبر و ایجاد فاکتور فروش.</li>
                    <li><b>فاکتور فروش دستی:</b> ایجاد فاکتور بدون فایل ورودی.</li>
                    <li><b>خروجی مغایرت‌ها:</b> خروجی گرفتن از ردیف‌های خطادار.</li>
                </ul>

                <h3>نکته</h3>
                <p>اگر نام کالا شناسایی نشد، نام را اصلاح کنید و دوباره پیش‌نمایش بگیرید.</p>
                """
            )
        ),
    ),
    "Purchase Invoice": HelpContent(
        title=_t("راهنمای بخش فاکتور خرید"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>برای ثبت خرید جدید و افزایش موجودی کالاها استفاده می‌شود.</p>

                <h3>دکمه‌های اصلی</h3>
                <ul>
                    <li><b>افزودن ردیف:</b> افزودن کالای جدید به فاکتور.</li>
                    <li><b>حذف ردیف انتخابی:</b> حذف ردیف‌های انتخاب‌شده.</li>
                    <li><b>ثبت فاکتور خرید:</b> ثبت نهایی فاکتور و اعمال روی موجودی.</li>
                </ul>

                <h3>نکته</h3>
                <p>قبل از ثبت، پیش‌نمایش فاکتور را بررسی کنید تا مقدارها دقیق باشند.</p>
                """
            )
        ),
    ),
    "Invoices": HelpContent(
        title=_t("راهنمای بخش فاکتورها"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>آرشیو کامل فاکتورهای خرید و فروش در این صفحه نمایش داده می‌شود.</p>

                <h3>قابلیت‌ها</h3>
                <ul>
                    <li>مشاهده لیست فاکتورها و جزئیات هر فاکتور.</li>
                    <li>ویرایش نام یا ردیف‌ها (با سطح دسترسی مناسب).</li>
                    <li>حذف فاکتور (با سطح دسترسی مناسب).</li>
                    <li>گرفتن خروجی اکسل یا پی‌دی‌اف.</li>
                    <li>خروجی گروهی با بازه تاریخ و فیلتر کالا.</li>
                </ul>

                <h3>نکته</h3>
                <p>پس از هر ویرایش یا حذف، برای همگام‌سازی کامل روی «بروزرسانی» کلیک کنید.</p>
                """
            )
        ),
    ),
    "Analytics": HelpContent(
        title=_t("راهنمای بخش تحلیل"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>نمای خلاصه فروش، خرید، سود و روند ماهانه را نمایش می‌دهد.</p>

                <h3>موارد قابل مشاهده</h3>
                <ul>
                    <li>جمع فروش، جمع خرید و سود کل.</li>
                    <li>تعداد فاکتورهای محاسبه‌شده.</li>
                    <li>جدول ماهانه و ستون روند برای مقایسه سریع.</li>
                </ul>
                """
            )
        ),
    ),
    "Low Stock": HelpContent(
        title=_t("راهنمای بخش کمبود موجودی"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>کالاهای زیر حد هشدار را برای سفارش مجدد نمایش می‌دهد.</p>

                <h3>موارد اصلی</h3>
                <ul>
                    <li>ستون‌های کالا، تعداد، هشدار، نیاز، میانگین خرید و منبع.</li>
                    <li>جمع تعداد کالاهای کمبوددار و مجموع نیاز.</li>
                    <li>خروجی اکسل یا CSV از لیست کمبود.</li>
                </ul>
                """
            )
        ),
    ),
    "Basalam": HelpContent(
        title=_t("راهنمای بخش باسلام"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>برای دریافت سفارش‌ها در بازه زمانی دلخواه و خروجی گرفتن از داده‌ها استفاده می‌شود.</p>

                <h3>مراحل کار</h3>
                <ul>
                    <li>بازه تاریخ پرداخت را مشخص کنید.</li>
                    <li>روی «دریافت سفارشات» کلیک کنید.</li>
                    <li>بعد از اتمام، در صورت نیاز خروجی بگیرید.</li>
                </ul>

                <h3>نکته</h3>
                <p>برای دریافت اطلاعات، مقدار کلید دسترسی باید در پیکربندی برنامه ثبت شده باشد.</p>
                """
            )
        ),
    ),
    "Actions": HelpContent(
        title=_t("راهنمای بخش اقدامات"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>تمام عملیات ثبت‌شده کاربران و سیستم در این صفحه قابل پیگیری است.</p>

                <h3>قابلیت‌ها</h3>
                <ul>
                    <li>جستجو در عنوان و جزئیات اقدامات.</li>
                    <li>بارگذاری مرحله‌ای برای لیست‌های طولانی.</li>
                    <li>نمایش جزئیات کامل هر اقدام در بخش پایین صفحه.</li>
                </ul>
                """
            )
        ),
    ),
    "Reports/Logs": HelpContent(
        title=_t("راهنمای بخش گزارش‌ها و لاگ‌ها"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>نمایش لاگ‌های برنامه برای بررسی خطاها و عملیات انجام‌شده.</p>

                <h3>دکمه‌های اصلی</h3>
                <ul>
                    <li><b>بارگذاری کامل:</b> نمایش کل تاریخچه لاگ.</li>
                    <li><b>نمایش 1000 خط آخر:</b> مشاهده سریع آخرین رخدادها.</li>
                    <li><b>خروجی 1000 خط آخر:</b> ذخیره گزارش در فایل متنی.</li>
                </ul>
                """
            )
        ),
    ),
    "Settings": HelpContent(
        title=_t("راهنمای بخش تنظیمات"),
        body=_wrap(
            _t(
                """
                <h3>کاربرد این بخش</h3>
                <p>تنظیمات ظاهری برنامه، مدیریت حساب‌ها و امنیت در این صفحه انجام می‌شود.</p>

                <h3>موارد اصلی</h3>
                <ul>
                    <li>انتخاب پوسته نمایش.</li>
                    <li>تغییر رمز عبور کاربر فعلی.</li>
                    <li>ایجاد، مشاهده و حذف مدیران سیستم.</li>
                    <li>تنظیم زمان قفل خودکار برنامه.</li>
                </ul>
                """
            )
        ),
    ),
}


def get_help_content(page_name: str) -> HelpContent:
    content = HELP_CONTENT.get(page_name)
    if content:
        return content
    return HelpContent(
        title=_t("راهنمای این بخش"),
        body=_wrap(
            _t(
                """
                <p>برای این بخش هنوز راهنمای اختصاصی آماده نشده است.</p>
                """
            )
        ),
    )
