from __future__ import annotations

from typing import NamedTuple


class HelpContent(NamedTuple):
    title: str
    body: str


def _wrap(body: str) -> str:
    return (
        '<div dir="rtl" style="font-family: '"'"'Vazirmatn'"'"', '"'"'Segoe UI'"'"'; '
        'font-size: 13px; line-height: 1.9; text-align: right;">'
        + body.strip()
        + "</div>"
    )


HELP_CONTENT: dict[str, HelpContent] = {
    "Inventory": HelpContent(
        title="راهنمای کامل بخش انبار",
        body=_wrap(
            """
            <h3>عنوان و نوار بالای برنامه</h3>
            <ul>
                <li><b>عنوان صفحه:</b> بالای این تب عنوان انگلیسی «Inventory Overview» نمایش داده می‌شود.</li>
                <li><b>دکمه «Select Inventory File»:</b> برای انتخاب فایل انبار است. تا زمانی که فایل انتخاب نشود،
                پیام «No inventory loaded» نمایش داده می‌شود.</li>
                <li><b>وضعیت فایل:</b> بعد از انتخاب فایل، نام فایل و تعداد کالاها به صورت «نام فایل | تعداد محصولات» نمایش داده می‌شود.</li>
                <li><b>دکمه «Lock»:</b> برنامه را قفل می‌کند تا دسترسی کنترل شود.</li>
                <li><b>دکمه «؟»:</b> همین راهنما را باز می‌کند.</li>
            </ul>

            <h3>اجزای اصلی صفحه انبار</h3>
            <ul>
                <li><b>کادر جستجو «Search products...»:</b> برای فیلتر سریع لیست. کافی است بخشی از نام کالا را تایپ کنید تا جدول فیلتر شود.</li>
                <li><b>دکمه «Reload»:</b> اطلاعات را دوباره از فایل می‌خواند و همه تغییرات ذخیره‌نشده را کنار می‌گذارد.</li>
                <li><b>دکمه «Save Changes»:</b> همه ویرایش‌های انجام‌شده در جدول را در فایل انبار ذخیره می‌کند.</li>
                <li><b>دکمه «Export»:</b> از داده‌های فعلی انبار خروجی می‌گیرد (برای گزارش‌گیری یا ارسال به دیگران).</li>
                <li><b>جدول کالاها:</b> همه ستون‌های اطلاعاتی کالا را نمایش می‌دهد. با کلیک روی عنوان ستون‌ها، مرتب‌سازی انجام می‌شود.</li>
            </ul>

            <h3>نکات مهم کار با جدول انبار</h3>
            <ul>
                <li>برای ویرایش، روی سلول کلیک کنید و مقدار جدید را وارد کنید.</li>
                <li>برای لیست‌های بزرگ، داده‌ها به‌صورت مرحله‌ای بارگذاری می‌شوند و با اسکرول به پایین، ردیف‌های بعدی می‌آید.</li>
                <li>اگر ستونی قفل باشد، قابل ویرایش نیست تا از خطا جلوگیری شود.</li>
            </ul>

            <h3>راهنمای بسیار کامل آیکن‌های نوار کناری</h3>
            <ul>
                <li><b>انبار (Inventory):</b> قلب سیستم مدیریت کالاهاست. در این بخش می‌توانید موجودی فعلی، قیمت خرید، حد هشدار، منبع کالا و سایر ستون‌ها را ببینید و ویرایش کنید. هر تغییر با «Save Changes» روی فایل اصلی ثبت می‌شود.</li>
                <li><b>ورود فروش (Sales Import):</b> برای وارد کردن فایل‌های فروش دوره‌ای از اکسل/CSV است. سیستم با این فایل‌ها موجودی را کاهش می‌دهد و فاکتور فروش می‌سازد. اگر نام کالا دقیق نباشد، می‌توانید همان‌جا اصلاح کنید تا با انبار تطبیق داده شود.</li>
                <li><b>فاکتور خرید (Purchase Invoice):</b> برای ثبت خریدهای جدید و افزایش موجودی است. چند قلم کالا را می‌توانید در یک فاکتور وارد کنید تا هم موجودی اضافه شود و هم میانگین قیمت خرید بروزرسانی گردد.</li>
                <li><b>فاکتورها (Invoices):</b> آرشیو کامل فاکتورهای خرید و فروش. امکان مشاهده جزئیات، خروجی گرفتن و در صورت داشتن دسترسی، ویرایش یا حذف برخی فاکتورها وجود دارد.</li>
                <li><b>تحلیل‌ها (Analytics):</b> نمای کلی فروش، خرید، سود و تعداد فاکتورها را نشان می‌دهد. جدول ماهانه کمک می‌کند روندها و فصل‌های قوی یا ضعیف را تشخیص دهید.</li>
                <li><b>کمبود موجودی (Low Stock):</b> فهرست کالاهایی که زیر حد هشدار هستند. ستون «Needed» مقدار پیشنهادی برای سفارش مجدد را نشان می‌دهد.</li>
                <li><b>باسلام (Basalam):</b> دریافت سفارش‌های باسلام با تعیین بازه پرداخت جلالی. پس از دریافت می‌توانید خروجی اکسل بگیرید و گزارش بسازید.</li>
                <li><b>اقدامات (Actions):</b> تاریخچه همه عملیات انجام‌شده توسط کاربران یا سیستم. برای پیگیری تغییرات و شفافیت بسیار مهم است.</li>
                <li><b>گزارش‌ها و لاگ‌ها (Reports/Logs):</b> نمایش گزارش‌های سیستمی و متن لاگ‌ها برای عیب‌یابی، همراه با امکان مشاهده آخرین خطوط و گرفتن خروجی.</li>
                <li><b>تنظیمات (Settings):</b> مدیریت پوشه پشتیبان، تغییر تم، مدیریت ادمین‌ها، تغییر رمز عبور و تنظیم زمان قفل خودکار برنامه.</li>
            </ul>
            """
        ),
    ),
    "Sales Import": HelpContent(
        title="راهنمای کامل بخش ورود فروش",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Sales Import» است و هدف آن وارد کردن فروش از فایل‌های اکسل/CSV برای کم کردن موجودی و ساخت فاکتور فروش می‌باشد.
            </p>

            <h3>اجزای صفحه و دکمه‌ها</h3>
            <ul>
                <li><b>کادر مسیر فایل «Select sales Excel/CSV file (Product Name, Quantity)...»:</b> مسیر فایل انتخاب‌شده را نشان می‌دهد.</li>
                <li><b>دکمه «Browse»:</b> پنجره انتخاب فایل را باز می‌کند تا فایل فروش را انتخاب کنید.</li>
                <li><b>دکمه «Load Preview»:</b> فایل را می‌خواند و پیش‌نمایش نتایج را در جدول نمایش می‌دهد.</li>
                <li><b>دکمه «Manual Invoice»:</b> برای ثبت دستی فروش و ساخت فاکتور دستی استفاده می‌شود.</li>
                <li><b>دکمه «Apply Updates»:</b> تغییرات را اعمال می‌کند؛ موجودی کم می‌شود و فاکتور فروش ثبت می‌گردد.</li>
                <li><b>دکمه «Export»:</b> نتیجه پیش‌نمایش را به فایل خروجی تبدیل می‌کند (تا قبل از پیش‌نمایش فعال نیست).</li>
            </ul>

            <h3>خلاصه بالا</h3>
            <ul>
                <li><b>«Total»:</b> تعداد کل ردیف‌های فایل.</li>
                <li><b>«Success»:</b> تعداد ردیف‌های موفق.</li>
                <li><b>«Errors»:</b> تعداد ردیف‌هایی که خطا دارند.</li>
            </ul>

            <h3>ستون‌های جدول پیش‌نمایش</h3>
            <ul>
                <li><b>«Product»:</b> نام کالا (در صورت نیاز قابل ویرایش برای تطبیق با انبار).</li>
                <li><b>«Quantity Sold»:</b> تعداد فروخته‌شده.</li>
                <li><b>«Status»:</b> وضعیت هر ردیف (موفق یا خطادار).</li>
                <li><b>«Message»:</b> پیام خطا یا توضیح مربوط به هر ردیف.</li>
            </ul>

            <h3>نکات کاربردی</h3>
            <ul>
                <li>ستون‌های پیشنهادی فایل: «Product Name» و «Quantity» یا «Quantity Sold» و در صورت وجود «Sell Price» برای تحلیل سود.</li>
                <li>بعد از اصلاح نام کالاها، دوباره پیش‌نمایش را بررسی کنید تا خطاها کم شوند.</li>
            </ul>
            """
        ),
    ),
    "Purchase Invoice": HelpContent(
        title="راهنمای کامل بخش فاکتور خرید",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Purchase Invoice» است و برای ثبت خریدهای جدید استفاده می‌شود تا موجودی افزایش پیدا کند.
            </p>

            <h3>اجزای صفحه و دکمه‌ها</h3>
            <ul>
                <li><b>جدول اقلام:</b> ستون‌های «Product»، «Buy Price» و «Quantity» دارد.</li>
                <li><b>دکمه «Add Line»:</b> یک ردیف جدید برای وارد کردن کالای تازه اضافه می‌کند.</li>
                <li><b>دکمه «Remove Selected»:</b> ردیف‌های انتخاب‌شده را حذف می‌کند.</li>
                <li><b>دکمه «Submit Invoice»:</b> فاکتور خرید را ثبت می‌کند و موجودی افزایش می‌یابد.</li>
            </ul>

            <h3>نحوه ورود اطلاعات</h3>
            <ul>
                <li><b>«Product»:</b> نام کالا را تایپ کنید؛ سیستم پیشنهادهای مشابه از انبار را نمایش می‌دهد.</li>
                <li><b>«Buy Price»:</b> قیمت خرید هر واحد را وارد کنید.</li>
                <li><b>«Quantity»:</b> تعداد خرید را مشخص کنید.</li>
            </ul>

            <h3>نکات سریع</h3>
            <ul>
                <li>با فشردن Enter بین ردیف‌ها سریع جابه‌جا می‌شوید.</li>
                <li>کلید Delete برای حذف ردیف‌های انتخاب‌شده عمل می‌کند.</li>
            </ul>
            """
        ),
    ),
    "Invoices": HelpContent(
        title="راهنمای کامل بخش فاکتورها",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Invoices» است و آرشیو همه فاکتورهای خرید و فروش را نمایش می‌دهد.
            </p>

            <h3>دکمه‌ها</h3>
            <ul>
                <li><b>دکمه «Factor»:</b> خروجی فاکتور به قالب مناسب چاپ/ارسال تولید می‌کند.</li>
                <li><b>دکمه «Refresh»:</b> لیست فاکتورها را بروزرسانی می‌کند.</li>
                <li><b>دکمه «Edit Invoice»:</b> فقط برای برخی فاکتورهای خرید و با دسترسی مناسب فعال می‌شود.</li>
                <li><b>دکمه «Delete Invoice»:</b> حذف فاکتور انتخاب‌شده (با دسترسی مناسب).</li>
                <li><b>دکمه «Load More»:</b> فاکتورهای قدیمی‌تر را بارگذاری می‌کند.</li>
            </ul>

            <h3>خلاصه بالا</h3>
            <ul>
                <li><b>«Total invoices»:</b> تعداد کل فاکتورهای موجود.</li>
                <li><b>«Total amount»:</b> جمع مبلغ کل فاکتورها.</li>
            </ul>

            <h3>ستون‌های جدول فاکتورها</h3>
            <ul>
                <li><b>«Date (IR)»:</b> تاریخ فاکتور (جلالی).</li>
                <li><b>«شماره فاکتور»:</b> شماره یکتا.</li>
                <li><b>«Type»:</b> نوع فاکتور (خرید/فروش).</li>
                <li><b>«Lines»:</b> تعداد اقلام.</li>
                <li><b>«Quantity»:</b> مجموع تعداد اقلام.</li>
                <li><b>«Admin»:</b> کاربری که فاکتور را ثبت کرده است.</li>
                <li><b>«Total»:</b> مبلغ کل فاکتور.</li>
                <li><b>«Export»:</b> خروجی گرفتن از همان فاکتور.</li>
            </ul>

            <h3>جزئیات پایین</h3>
            <ul>
                <li>با انتخاب هر فاکتور، جدول جزئیات نمایش داده می‌شود.</li>
                <li>ستون‌ها شامل «Product»، «Price»، «Qty» و «Line Total» هستند.</li>
            </ul>
            """
        ),
    ),
    "Analytics": HelpContent(
        title="راهنمای کامل بخش تحلیل‌ها",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Analytics» است و برای بررسی عملکرد مالی و روندها استفاده می‌شود.
            </p>

            <h3>دکمه‌ها و شاخص‌ها</h3>
            <ul>
                <li><b>دکمه «Refresh»:</b> محاسبات را دوباره انجام می‌دهد تا آخرین ارقام نمایش داده شوند.</li>
                <li><b>«Sales total»:</b> جمع کل فروش ثبت‌شده.</li>
                <li><b>«Purchase total»:</b> جمع کل خرید ثبت‌شده.</li>
                <li><b>«Profit»:</b> سود (تفاضل فروش و خرید).</li>
                <li><b>«Invoices»:</b> تعداد کل فاکتورهای محاسبه‌شده.</li>
            </ul>

            <h3>جدول ماهانه</h3>
            <ul>
                <li><b>«Month (IR)»:</b> ماه جلالی.</li>
                <li><b>«Sales»:</b> فروش همان ماه.</li>
                <li><b>«Purchases»:</b> خرید همان ماه.</li>
                <li><b>«Profit»:</b> سود ماهانه.</li>
                <li><b>«Invoices»:</b> تعداد فاکتور در آن ماه.</li>
                <li><b>«Trend»:</b> نمودار میله‌ای برای مقایسه سریع فروش ماه‌ها.</li>
            </ul>
            """
        ),
    ),
    "Low Stock": HelpContent(
        title="راهنمای کامل بخش کمبود موجودی",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Low Stock Alerts» است و اقلامی را نشان می‌دهد که موجودی آن‌ها پایین‌تر از حد هشدار است.
            </p>

            <h3>دکمه‌ها</h3>
            <ul>
                <li><b>دکمه «Export»:</b> لیست کمبود را به فایل خروجی تبدیل می‌کند.</li>
                <li><b>دکمه «Refresh»:</b> محاسبه کمبودها را دوباره انجام می‌دهد.</li>
            </ul>

            <h3>خلاصه بالا</h3>
            <ul>
                <li><b>«Items below alarm»:</b> تعداد کالاهای زیر حد هشدار.</li>
                <li><b>«Total needed»:</b> مجموع تعداد پیشنهادی برای سفارش مجدد.</li>
            </ul>

            <h3>ستون‌های جدول</h3>
            <ul>
                <li><b>«Product»:</b> نام کالا.</li>
                <li><b>«Quantity»:</b> موجودی فعلی.</li>
                <li><b>«Alarm»:</b> حد هشدار تعیین‌شده.</li>
                <li><b>«Needed»:</b> میزان پیشنهادی برای رسیدن به حد هشدار.</li>
                <li><b>«Avg Buy»:</b> میانگین قیمت خرید.</li>
                <li><b>«Source»:</b> منبع یا تامین‌کننده کالا.</li>
            </ul>

            <h3>نکته</h3>
            <p>رنگ‌بندی ردیف‌ها شدت کمبود را نشان می‌دهد تا اولویت سفارش سریع‌تر مشخص شود.</p>
            """
        ),
    ),
    "Basalam": HelpContent(
        title="راهنمای کامل بخش باسلام",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Basalam Orders» است و برای دریافت سفارش‌های باسلام در بازه پرداخت مشخص استفاده می‌شود.
            </p>

            <h3>فیلدها و دکمه‌ها</h3>
            <ul>
                <li><b>«Start paid at (Jalali)»:</b> تاریخ و ساعت شروع بازه پرداخت به تقویم جلالی.</li>
                <li><b>«End paid at (Jalali)»:</b> تاریخ و ساعت پایان بازه پرداخت به تقویم جلالی.</li>
                <li><b>دکمه «Fetch»:</b> فرآیند دریافت سفارش‌ها را آغاز می‌کند.</li>
                <li><b>دکمه «Export»:</b> خروجی اکسل از سفارش‌های دریافت‌شده می‌گیرد (تا زمانی که داده نباشد غیرفعال است).</li>
            </ul>

            <h3>وضعیت و جدول</h3>
            <ul>
                <li><b>پیام «No data loaded.»:</b> یعنی هنوز سفارشی دریافت نشده است.</li>
                <li><b>نوار پیشرفت:</b> وضعیت دریافت داده‌ها را نشان می‌دهد.</li>
                <li><b>جدول سفارش‌ها:</b> بعد از دریافت، ستون‌ها به صورت پویا نمایش داده می‌شوند.</li>
            </ul>

            <h3>نکته مهم</h3>
            <p>برای دریافت سفارش‌ها باید کلید دسترسی باسلام را در فایل پیکربندی تنظیم کرده باشید.</p>
            """
        ),
    ),
    "Actions": HelpContent(
        title="راهنمای کامل بخش اقدامات",
        body=_wrap(
            """
            <h3>هدف</h3>
            <p>
                این بخش تاریخچه تمام عملیات ثبت‌شده را نمایش می‌دهد تا قابل پیگیری باشد.
            </p>

            <h3>کنترل‌ها</h3>
            <ul>
                <li><b>کادر جستجو «جستجو در اقدامات...»:</b> برای پیدا کردن اقدام‌های خاص.</li>
                <li><b>دکمه «بروزرسانی»:</b> لیست اقدامات را دوباره بارگذاری می‌کند.</li>
                <li><b>دکمه «موارد بیشتر»:</b> اقدامات قدیمی‌تر را نمایش می‌دهد.</li>
            </ul>

            <h3>جدول و جزئیات</h3>
            <ul>
                <li>ستون‌های جدول شامل تاریخ، ادمین، نوع و عنوان است.</li>
                <li>با انتخاب هر ردیف، جزئیات کامل در پایین نمایش داده می‌شود.</li>
            </ul>
            """
        ),
    ),
    "Reports/Logs": HelpContent(
        title="راهنمای کامل بخش گزارش‌ها و لاگ‌ها",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Reports & Logs» است و برای مشاهده گزارش‌ها و لاگ‌های سیستمی استفاده می‌شود.
            </p>

            <h3>دکمه‌ها</h3>
            <ul>
                <li><b>دکمه «Refresh All»:</b> کل تاریخچه لاگ‌ها را بارگذاری می‌کند.</li>
                <li><b>دکمه «Show Last 1000»:</b> فقط ۱۰۰۰ خط آخر را نمایش می‌دهد.</li>
                <li><b>دکمه «Export Last 1000»:</b> ۱۰۰۰ خط آخر را در فایل متنی ذخیره می‌کند.</li>
            </ul>

            <h3>نمایشگر گزارش</h3>
            <p>متن لاگ‌ها به صورت قابل خواندن نمایش داده می‌شود و برای عیب‌یابی کاربرد دارد.</p>
            """
        ),
    ),
    "Settings": HelpContent(
        title="راهنمای کامل بخش تنظیمات",
        body=_wrap(
            """
            <h3>عنوان و هدف</h3>
            <p>
                عنوان این تب «Settings» است و برای پیکربندی برنامه و مدیریت دسترسی‌ها استفاده می‌شود.
            </p>

            <h3>پشتیبان‌گیری</h3>
            <ul>
                <li><b>برچسب «Backup folder:»:</b> مسیر فعلی ذخیره پشتیبان‌ها را نشان می‌دهد.</li>
                <li><b>دکمه «Choose»:</b> انتخاب پوشه جدید برای ذخیره پشتیبان.</li>
                <li><b>دکمه «Default»:</b> بازگشت به مسیر پیش‌فرض.</li>
            </ul>

            <h3>ظاهر برنامه</h3>
            <ul>
                <li><b>برچسب «Theme:»:</b> انتخاب تم نمایش.</li>
                <li><b>گزینه‌ها «Light» و «Dark»:</b> تغییر روشنایی رابط.</li>
            </ul>

            <h3>حساب کاربری</h3>
            <ul>
                <li><b>برچسب «Current user:»:</b> نام کاربر وارد شده.</li>
                <li><b>فیلدهای «Current password»، «New password»، «Confirm password»:</b> برای تغییر رمز عبور.</li>
                <li><b>دکمه «Update password»:</b> ثبت رمز جدید.</li>
                <li><b>برچسب «Auto lock (minutes):»:</b> زمان قفل خودکار بر حسب دقیقه.</li>
                <li><b>دکمه «Save»:</b> ذخیره زمان قفل خودکار.</li>
            </ul>

            <h3>مدیریت ادمین‌ها</h3>
            <ul>
                <li><b>فیلد «Username» و «Password»:</b> تعریف ادمین جدید.</li>
                <li><b>نقش‌های «employee» و «manager»:</b> سطح دسترسی ادمین.</li>
                <li><b>دکمه «Create admin»:</b> ساخت ادمین جدید.</li>
                <li><b>جدول ادمین‌ها:</b> ستون‌های «Username»، «Role»، «Auto lock (min)» را نمایش می‌دهد.</li>
            </ul>
            """
        ),
    ),
}


def get_help_content(page_name: str) -> HelpContent:
    content = HELP_CONTENT.get(page_name)
    if content:
        return content
    return HelpContent(
        title="راهنمای این بخش",
        body=_wrap(
            """
            <p>برای این بخش هنوز راهنمای اختصاصی آماده نشده است.</p>
            """
        ),
    )
